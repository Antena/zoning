<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Zoning</title>

    <!--CSS Styles-->
    <link rel="stylesheet" href="/assets/css/jquery-ui-1.9.1.custom.min.css" />
    <link rel="stylesheet" href="/assets/css/style.css"/>

    <!--JS Scripts-->
    <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
    <script src="/assets/js/jquery-1.8.2.js"></script>
    <script src="/assets/js/jquery-ui.js"></script>
    <script src="/assets/js/FTClient.js"></script>
    <script src="/assets/js/Township.js"></script>
    <script src="/assets/js/MapManager.js"></script>

    <script>
        function initialize() {
            // Map Manager
            var mapManager = new MapManager({
                containerDivId : "map_canvas",
                center : { lat: -34.773204, lng: -58.348633 },
                zoom : 9,
                mapTypeId : google.maps.MapTypeId.ROADMAP,
                ftId : "1Jus0SKiGtttLllonNtWEXRvnyHd4rwybZkOYeVQ",
                ftLimitColumnName : "'Límite'",
                urbAreaFilename : "urbArea",
                urbFootprintFilename : "urbFootprint",
                newDevelopmentFilename : "newDevelopment",
                activeTownshipColor: "#00FF00"
            });

            var ftClient = new FTClient("1Jus0SKiGtttLllonNtWEXRvnyHd4rwybZkOYeVQ");
            ftClient.query(['Nombre'], null, function(data) {
                var rows = data.table.rows;

                for (var i=0; i<rows.length; i++) {
                    var name = rows[i][0];
                    mapManager.addTownship(name);
                }
            });

            initControls(mapManager);
        }

        function initControls(mapManager) {
            $("#slider-time").slider({
                max: 1,
                min: 0,
                value: 0,
                disabled: true,
                animate: "fast",
                slide: function(event, ui) {
                    mapManager.setHistoricalTime(ui.value);
                }
            });

            $("#limit > input:radio").button({disabled:true}).change(function(event) {
                var radioId = $("#limit > input:checked").attr("id");
                var township = mapManager.getActiveTownship();
                if (radioId == "showLimit") {
                    mapManager.showHideLimit(township.getName(), 1);
                } else {
                    mapManager.showHideLimit(township.getName(), 0);
                }
            });
            $("#limit").buttonset();

            $("#slider-urbArea").slider({
                max: 100,
                min: 0,
                value: 50,
                disabled: true,
                animate: "fast",
                slide: function(event, ui) {
                    var township = mapManager.getActiveTownship();
                    township.setUrbAreaOpacity(ui.value/100);
                }
            });

            $("#slider-urbFootprint").slider({
                max: 100,
                min: 0,
                value: 50,
                disabled: true,
                animate: "fast",
                slide: function(event, ui) {
                    var township = mapManager.getActiveTownship();
                    township.setUrbFootprintOpacity(ui.value/100);
                }
            });

            $("#slider-newDevelopment").slider({
                max: 100,
                min: 0,
                value: 50,
                disabled: true,
                animate: "fast",
                slide: function(event, ui) {
                    var township = mapManager.getActiveTownship();
                    township.getNewDevelopment().setOpacity(ui.value/100);
                }
            });
        }

        function enableSlider(sliderDivId) {
            if ($("#" + sliderDivId).slider("option","disabled")) {
                $("#" + sliderDivId).slider("option","disabled", false);
            }
        }

        function enableButtonset(buttonsetDivId) {
            $("#" + buttonsetDivId +" > input:radio").button( "option", "disabled", false );
            $("#showLimit").attr("checked", "checked");
            $("#hideLimit").removeAttr("checked");
        }


        function resetControls(mapManager) {
            var activeTownship = mapManager.getActiveTownship();

            enableSlider("slider-time");
            enableButtonset("limit");
            enableSlider("slider-urbArea");
            enableSlider("slider-urbFootprint");
            enableSlider("slider-newDevelopment");

            $("#slider-limit").slider("value", 1);
            $("#slider-urbArea").slider("value", activeTownship.getUrbArea().getOpacity()*100);
            $("#slider-urbFootprint").slider("value", activeTownship.getUrbFootprint().getOpacity()*100);
            $("#slider-newDevelopment").slider("value", activeTownship.getNewDevelopment().getOpacity()*100);
        }
    </script>
</head>
<body onload="initialize()">
<div id="controls">

    <div class="control">
        <div class="label">Año</div>
        <div id="slider-time" class="slider"></div>
        <div class="range">
            <span class="left">1990</span><span class="right">2000</span>
        </div>

    </div>

    <div class="control" style="margin-bottom: 15px;">
        <div class="label">Límite del municipio:</div>
        <div id="limit">
            <input type="radio" id="showLimit" name="radio" checked="checked" /><label for="showLimit">Mostrar</label>
            <input type="radio" id="hideLimit" name="radio" /><label for="hideLimit">Esconder</label>
        </div>
    </div>

    <div class="control">
        <div class="label">Urban Area:</div>
        <div id="slider-urbArea" class="slider"></div>
        <div class="range">
            <span class="left">0%</span><span class="right">100%</span>
        </div>
    </div>

    <div class="control">
        <div class="label">Urban Footprint:</div>
        <div id="slider-urbFootprint" class="slider"></div>
        <div class="range">
            <span class="left">0%</span><span class="right">100%</span>
        </div>
    </div>

    <div class="control">
        <div class="label">New Development:</div>
        <div id="slider-newDevelopment" class="slider"></div>
        <div class="range">
            <span class="left">0%</span><span class="right">100%</span>
        </div>
    </div>

</div>
<div id="map_canvas"></div>
</body>
</html>